<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyber-Scan Pro | Professional Record Finder</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>

    <style>
        @import url('https://fonts.cdnfonts.com/css/solaimanlipi');

        :root {
            --primary: #3b82f6;
            --accent: #06b6d4;
            --bg-dark: #0f172a;
            --card-bg: #1e293b;
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --border: #334155;
            --success: #22c55e;
        }

        body {
            background: var(--bg-dark);
            color: var(--text-main);
            font-family: 'SolaimanLipi', sans-serif;
            margin: 0; padding: 0;
            display: flex; justify-content: center;
            line-height: 1.6;
        }

        .container { max-width: 900px; width: 95%; margin-top: 40px; margin-bottom: 50px; }

        header { text-align: center; margin-bottom: 30px; }
        header h1 { color: var(--accent); margin-bottom: 5px; }
        header p { color: var(--text-muted); font-size: 0.9rem; }

        .search-box {
            position: sticky; top: 20px;
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(12px);
            padding: 25px; border: 1px solid var(--border);
            border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            z-index: 100;
        }

        select, input {
            width: 100%; background: #0f172a;
            border: 1px solid var(--border); border-radius: 8px;
            color: white; font-size: 1rem; padding: 12px 15px;
            outline: none; font-family: 'SolaimanLipi', sans-serif;
            margin-bottom: 12px; box-sizing: border-box;
            transition: all 0.3s;
        }

        select:focus, input:focus { border-color: var(--primary); box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3); }

        #searchBtn {
            width: 100%; padding: 12px; background: var(--primary);
            color: white; border: none; border-radius: 8px;
            font-weight: bold; cursor: pointer; margin-bottom: 12px;
            font-family: 'SolaimanLipi', sans-serif; transition: opacity 0.3s;
        }
        #searchBtn:hover { opacity: 0.9; }

        .status { font-size: 0.85rem; color: var(--accent); text-align: right; margin-bottom: 8px; font-weight: bold; }

        .progress { height: 6px; background: #334155; border-radius: 10px; overflow: hidden; margin-bottom: 10px; }
        .progress span { display: block; height: 100%; width: 0%; background: linear-gradient(90deg, var(--primary), var(--accent)); transition: width 0.3s; }

        #downloadBtn {
            width: 100%; padding: 12px; background: var(--success);
            color: white; border: none; border-radius: 8px;
            font-weight: bold; cursor: pointer; display: none;
            font-family: 'SolaimanLipi', sans-serif; transition: opacity 0.3s;
        }
        #downloadBtn:hover { opacity: 0.9; }

        .result-card {
            background: var(--card-bg); margin-top: 15px; padding: 20px;
            border-radius: 12px; border: 1px solid var(--border);
            animation: fadeIn 0.4s ease forwards;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .data-content { font-size: 1.05rem; color: #e2e8f0; line-height: 1.8; }
        .label-text { color: var(--accent); font-weight: bold; margin-right: 5px; }
        .highlight { background: rgba(255, 230, 0, 0.3); color: #fff; padding: 0 2px; border-radius: 2px; }

        .count { text-align: center; margin: 30px 0; color: var(--text-muted); }
        .error-msg { color: #ef4444; background: rgba(239, 68, 68, 0.1); padding: 10px; border-radius: 8px; margin-top: 10px; font-size: 0.9rem; }
    </style>
</head>

<body>
<div class="container">
    <header>
        <h1>Bhola 4</h1>
        <p>প্রফেশনাল ভোটার রেকর্ড সার্চ ইঞ্জিন</p>
    </header>

    <div class="search-box">
        <div id="status" class="status">সিস্টেম প্রস্তুত করা হচ্ছে...</div>
        <div class="progress"><span id="bar"></span></div>
        
        <select id="pdfSelect">
            <option value="pdfs/8n_male.pdf">৮নং ওয়ার্ড – পুরুষ</option>
            <option value="pdfs/8n_female.pdf">৮নং ওয়ার্ড – মহিলা</option>
        </select>
        
        <input id="searchInput" placeholder="নাম, জন্ম তারিখ অথবা ভোটার নং দিয়ে খুঁজুন..." autocomplete="off">
        <button id="searchBtn">তথ্য খুঁজুন</button>
        
        <button id="downloadBtn">ফলাফল ডাউনলোড করুন (.txt)</button>
        <div id="errorBox"></div>
    </div>

    <div id="results"></div>
    <div id="count" class="count"></div>
</div>

<script>
const pdfjsLib = window['pdfjs-dist/build/pdf'];
pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

const e2b = {"0":"০","1":"১","2":"২","3":"৩","4":"৪","5":"৫","6":"৬","7":"৭","8":"৮","9":"৯"};
const b2e = {"০":"0","১":"1","২":"2","৩":"3","৪":"4","৫":"5","৬":"6","৭":"7","৮":"8","৯":"9"};
const toBn = s => s.replace(/[0-9]/g, d => e2b[d]);
const toEn = s => s.replace(/[০-৯]/g, d => b2e[d]);

const fixMap = {
    "িক":"কি","িখ":"খি","িগ":"গি","িঘ":"ঘি","িচ":"চি","িছ":"ছি","িজ":"জি","িট":"টি","িঠ":"ঠি","িড":"ডি","িণ":"ণি","িত":"তি","িথ":"থি","িদ":"দি","িন":"নি","িপ":"পি","িফ":"ফি","িব":"বি","িভ":"ভি","িম":"মি","ির":"রি","িল":"লি","িশ":"শি","িষ":"ষি","িস":"সি","িহ":"হি","িড়":"ড়ি","িয়":"য়ি",
    "েক":"কে","েখ":"খে","েগ":"গে","েত":"তে","েন":"নে","েপ":"পে","েব":"বে","েম":"মে","ের":"রে","েল":"লে","েশ":"শে","েস":"সে",
    "োক":"কো","োগ":"গো","োচ":"চো","োত":"তো","োদ":"দো","োন":"নো","োপ":"পো","োব":"বো","োম":"মো","োর":"রো","োল":"লো","ৌশ":"শৌ",
    "Ïমাঃ":"মোঃ","Ïবগম":"বেগম","Ïভাটার নং":"ভোটার নং","আ×ার":"আক্তার","জĥ তািরখ":"জন্ম তারিখ","ę":"দ","Ɓ":"রু","Ň":"ম্ম","ছাĔ/ছাĔ":"ছাত্র/ছাত্রী","আ×ার": "আক্তার","িপতা":"পিতা","িঠকানা":"ঠিকানা","জĥ তািরখ":"জন্ম তারিখ","চর ফËাশন": "চর ফ্যাশন","Ï":"ি","চর ফ্যাশন,": "চর ফ্যাশন, ভোলা।",
    "Řিমক": "শ্রমিক", "বËবসা": "ব্যবসা", "Ïবসরকারী চাƣরী": "বেসরকারী চাকুরী","ভলোা।": "ভোলা।","s": "নু","Ůলু": "স্কুল","Ů": "স্ক"," িবিব": "বিবি", "বািড়": "বাড়ি","ঠকিানা": "ঠিকানা","ƀফয়িা": "সুফিয়া","ƀ": "সু","ƃ": "দু","হিাসেন": "হোসেন",
    "ĥ": "ম", "Ë": "্য", "Ř": "শ", "ē": "ত", "ę": "দ", " িপশা:": "পেশা:", "Ïবসরকারী চাƣরী": "বেসরকারী চাকুরী","মিýল": "মঞ্জিল",
    " িবসরকারী চাƣরী": "বেসরকারী চাকুরী", "পাটÎ": "পার্ট", " িরাড": "রোড", "Ō": "ল্ল", "Ƅ": "শু", "Ñ": "ক্ক", "উতর": "উত্তর",
    "Ï": "ে", " েভালা": " ", " েপশা:": "পেশা:", "ė": "দ্দি",
    
    // Updated Formatting Labels
    "নাম:": "<br><span class='label-text'>নাম:</span>",
    "ভোটার নং:": "<br><span class='label-text'>ভোটার নং:</span>",
    "পিতা:": "<br><span class='label-text'>পিতা:</span>",
    "মাতা:": "<br><span class='label-text'>মাতা:</span>",
    "পেশা:": "<br><span class='label-text'>পেশা:</span>",
    "জন্ম তারিখ:": "<br><span class='label-text'>জন্ম তারিখ:</span>",
    "ঠিকানা:": "<br><span class='label-text'>ঠিকানা:</span>",
};

let records = [];

function fixBangla(t) {
    for (const k in fixMap) t = t.replaceAll(k, fixMap[k]);
    return t.replace(/[ ]{2,}/g, " ").trim();
}

async function loadPDF(path) {
    records = [];
    const s = document.getElementById("status");
    const bar = document.getElementById("bar");
    const err = document.getElementById("errorBox");
    err.innerHTML = "";
    s.textContent = "পিডিএফ লোড হচ্ছে..."; 
    bar.style.width = "10%";

    try {
        const loadingTask = pdfjsLib.getDocument(path);
        const pdf = await loadingTask.promise;
        let raw = "";
        
        for (let i = 1; i <= pdf.numPages; i++) {
            const p = await pdf.getPage(i);
            const c = await p.getTextContent();
            raw += c.items.map(x => x.str).join(" ") + " ";
            bar.style.width = (i / pdf.numPages * 100) + "%";
        }

        // Logic Change: This regex splits by finding the gap before one or more digits followed by a dot.
        // It correctly handles multiple digits (1234.) instead of just the last one.
        const splitPattern = /\s+(?=[\d০-৯]+\.)/g;
        records = raw.split(splitPattern).map(r => fixBangla(r)).filter(r => r.length > 20);
        
        s.textContent = "ডেটাবেস প্রস্তুত: " + toBn(String(records.length)) + " জন";
    } catch (e) {
        s.textContent = "ব্যর্থ হয়েছে";
        err.innerHTML = `<div class="error-msg">ত্রুটি: ${e.message}<br>নিশ্চিত করুন যে ফাইলটি 'pdfs' ফোল্ডারে আছে।</div>`;
        console.error(e);
    }
}

function search() {
    const q = document.getElementById("searchInput").value.trim();
    const out = document.getElementById("results");
    const cnt = document.getElementById("count");
    const btn = document.getElementById("downloadBtn");
    
    out.innerHTML = ""; 
    cnt.textContent = "";
    btn.style.display = "none";

    if (!q || !records.length) return;

    const qBn = toBn(q);
    const qEn = toEn(q);
    let foundCount = 0;

    records.forEach(r => {
        // Search check works for both Bengali and English digits
        if (r.includes(qBn) || r.includes(qEn)) {
            const highlighted = r.replaceAll(qBn, `<span class="highlight">${qBn}</span>`);
            out.innerHTML += `<div class="result-card"><div class="data-content">${highlighted}</div></div>`;
            foundCount++;
        }
    });

    if (foundCount > 0) {
        cnt.textContent = `মোট ফলাফল: ${toBn(String(foundCount))}`;
        btn.style.display = "block";
    } else {
        cnt.textContent = "কোনো তথ্য পাওয়া যায়নি";
    }
}

document.getElementById("downloadBtn").onclick = () => {
    const results = document.querySelectorAll(".result-card");
    let content = "Cyber-Scan Pro Search Results\n" + "=".repeat(30) + "\n\n";
    results.forEach((card, i) => {
        content += `[${i+1}] ${card.innerText}\n\n`;
    });
    const blob = new Blob([content], { type: "text/plain;charset=utf-8" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = `Search_Results_${new Date().toLocaleDateString()}.txt`;
    link.click();
};

document.getElementById("searchInput").oninput = e => {
    const cursor = e.target.selectionStart;
    e.target.value = toBn(e.target.value);
    e.target.setSelectionRange(cursor, cursor);
};

document.getElementById("searchBtn").onclick = () => search();
document.getElementById("searchInput").onkeydown = e => { if (e.key === "Enter") search(); };
document.getElementById("pdfSelect").onchange = e => loadPDF(e.target.value);
window.onload = () => loadPDF(document.getElementById("pdfSelect").value);
</script>
</body>
</html>



