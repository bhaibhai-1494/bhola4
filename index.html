<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cyber-Scan | Bangla PDF Search</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>

<style>
@font-face {
    font-family: 'SolaimanLipi';
    src: url('SolaimanLipi.ttf') format('truetype');
}

:root {
    --neon-blue:#00f3ff;
    --bg-dark:#020205;
    --glass:rgba(0,243,255,0.05);
}

body {
    margin:0;
    min-height:100vh;
    font-family:'SolaimanLipi', sans-serif;
    background:var(--bg-dark);
    color:#e0e0e0;
    display:flex;
    justify-content:center;
    background-image:
        linear-gradient(rgba(0,243,255,0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0,243,255,0.03) 1px, transparent 1px);
    background-size:40px 40px;
}

.container {
    margin-top:10vh;
    width:90%;
    max-width:900px;
}

h1 {
    text-align:center;
    letter-spacing:10px;
    font-weight:100;
    color:var(--neon-blue);
    text-shadow:0 0 15px var(--neon-blue);
    margin-bottom:40px;
}

.filters {
    display:flex;
    gap:15px;
    margin-bottom:20px;
}

select, input {
    width:100%;
    background:transparent;
    border:none;
    border-bottom:2px solid var(--neon-blue);
    padding:14px;
    color:white;
    font-size:1.2rem;
    outline:none;
}

select option {
    background:#020205;
}

.status {
    margin-top:15px;
    font-size:.75rem;
    letter-spacing:3px;
    color:var(--neon-blue);
    text-transform:uppercase;
}

.results {
    margin-top:40px;
}

.card {
    background:rgba(255,255,255,0.03);
    border-left:3px solid var(--neon-blue);
    padding:22px;
    margin-bottom:20px;
    border-radius:0 10px 10px 0;
    transition:.3s;
}

.card:hover {
    background:rgba(0,243,255,0.06);
    transform:translateX(8px);
}

.label {
    color:var(--neon-blue);
    font-size:.8rem;
    margin-bottom:10px;
    display:block;
    text-transform:uppercase;
}

.snippet {
    line-height:1.8;
    font-size:1.05rem;
    color:#ccc;
}

.highlight {
    background:rgba(0,243,255,0.35);
    color:white;
    padding:0 4px;
    border-radius:2px;
}
</style>
</head>

<body>

<div class="container">
    <h1>DATA SCANNER</h1>

    <div class="filters">
        <select id="areaFilter">
            <option value="all">All Areas</option>
            <option value="Dhaka">Dhaka</option>
            <option value="Chittagong">Chittagong</option>
        </select>

        <select id="genderFilter">
            <option value="all">All Genders</option>
            <option value="Male">Male</option>
            <option value="Female">Female</option>
        </select>
    </div>

    <input id="searchBox" placeholder="পিডিএফ এর ভেতরে অনুসন্ধান করুন...">
    <div id="status" class="status">Initializing Neural Index...</div>

    <div id="results" class="results"></div>
</div>

<script>
const pdfjsLib = window['pdfjs-dist/build/pdf'];
pdfjsLib.GlobalWorkerOptions.workerSrc =
'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

/* ===== PDF FILE MANAGEMENT ===== */
const pdfCollection = [
    { name:"Dhaka Male Report", url:"pdfs/dhaka_male.pdf", area:"Dhaka", gender:"Male" },
    { name:"Dhaka Female Report", url:"pdfs/dhaka_female.pdf", area:"Dhaka", gender:"Female" },
    { name:"CTG General Report", url:"pdfs/ctg_all.pdf", area:"Chittagong", gender:"All" }
];

let searchIndex = [];

/* ===== HELPERS ===== */
const normalizeBangla = t =>
    t.normalize("NFC").replace(/\s+/g," ").trim();

const escapeRegex = s =>
    s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");

/* ===== LOAD PDFs ===== */
async function extractPdfText(path){
    const pdf = await pdfjsLib.getDocument(path).promise;
    let text="";
    for(let i=1;i<=pdf.numPages;i++){
        const page = await pdf.getPage(i);
        const content = await page.getTextContent();
        text += content.items.map(i=>i.str).join(" ")+" ";
    }
    return normalizeBangla(text);
}

async function init(){
    const status=document.getElementById("status");
    for(const doc of pdfCollection){
        try{
            const content=await extractPdfText(doc.url);
            searchIndex.push({...doc,content});
        }catch(e){
            console.error("PDF load failed:",doc.url);
        }
    }
    status.innerText=`${searchIndex.length} Documents Indexed`;
}

/* ===== SEARCH ===== */
function runSearch(){
    const q=normalizeBangla(searchBox.value);
    const area=areaFilter.value;
    const gender=genderFilter.value;
    results.innerHTML="";

    if(q.length<2) return;

    searchIndex.forEach(doc=>{
        if(area!=="all" && doc.area!==area) return;
        if(gender!=="all" && doc.gender!==gender && doc.gender!=="All") return;
        if(!doc.content.includes(q)) return;

        const i=doc.content.indexOf(q);
        const snippet=doc.content.substring(
            Math.max(0,i-80),
            Math.min(doc.content.length,i+120)
        );

        const highlighted=snippet.replace(
            new RegExp(escapeRegex(q),"g"),
            `<span class="highlight">$&</span>`
        );

        results.innerHTML+=`
        <div class="card">
            <span class="label">${doc.name} | ${doc.area} | ${doc.gender}</span>
            <div class="snippet">...${highlighted}...</div>
        </div>`;
    });
}

/* ===== DEBOUNCE ===== */
let timer;
searchBox.addEventListener("input",()=>{
    clearTimeout(timer);
    timer=setTimeout(runSearch,300);
});

init();
</script>

</body>
</html>
